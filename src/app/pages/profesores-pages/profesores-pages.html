<app-admin-shell>
  <div class="container-fluid">
    <div class="d-flex justify-content-between align-items-start mb-3">
      <div>
        <h2 class="fw-bold text-dark">Profesores</h2>
        <p class="text-muted">Gestión de profesores supervisores</p>
      </div>
      <button class="btn btn-dark" (click)="openCreate()">Nuevo Profesor</button>
    </div>

    <div class="card shadow-sm mb-3">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <small class="text-muted d-block">Total Profesores</small>
          <span class="fw-semibold">{{ total }}</span>
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-outline-secondary btn-sm" [disabled]="page <= 1 || loading" (click)="load(page - 1)">
            Anterior
          </button>
          <span class="text-secondary small">Página {{ page }} / {{ lastPage }}</span>
          <button class="btn btn-outline-secondary btn-sm" [disabled]="page >= lastPage || loading" (click)="load(page + 1)">
            Siguiente
          </button>
        </div>
      </div>
    </div>

    <div class="card shadow-sm border-0">
      <div class="card-header bg-white d-flex justify-content-between align-items-center">
        <h6 class="m-0">Listado de Profesores</h6>
        <button class="btn btn-dark btn-sm" (click)="openCreate()" [disabled]="saving">
          Nuevo Profesor
        </button>
      </div>

      <div class="table-responsive">
        <table class="table table-borderless align-middle mb-0">
          <thead class="border-bottom">
            <tr class="text-muted small">
              <th>Nombre</th>
              <th>DNI</th>
              <th>Email</th>
              <th>Departamento</th>
              <th>Especialidad</th>
              <th>Estado</th>
              <th class="text-end">Acciones</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngIf="!loading && profesores.length === 0">
              <td colspan="7" class="text-center text-secondary py-4">
                No hay profesores registrados.
              </td>
            </tr>
            <tr *ngFor="let profesor of profesores">
              <td>
                <div class="fw-semibold">{{ profesor.user?.name || 'Usuario' }}</div>
                <small class="text-secondary">ID usuario: {{ profesor.user_id }}</small>
              </td>
              <td>{{ profesor.dni }}</td>
              <td>{{ profesor.user?.email }}</td>
              <td>{{ profesor.departamento }}</td>
              <td>{{ profesor.especialidad }}</td>
              <td>
                <span class="badge" [class.bg-success]="profesor.activo" [class.bg-secondary]="!profesor.activo">
                  {{ profesor.activo ? 'Activo' : 'Inactivo' }}
                </span>
              </td>
              <td class="text-end">
                <button class="btn btn-sm btn-outline-secondary me-2" (click)="openEdit(profesor)" [disabled]="saving">
                  Editar
                </button>
                <button class="btn btn-sm btn-outline-danger" (click)="remove(profesor)" [disabled]="saving">
                  Eliminar
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="alert alert-success mt-3" role="alert" *ngIf="successMessage">
      {{ successMessage }}
    </div>
    <div class="alert alert-danger mt-3" role="alert" *ngIf="errorMessage">
      {{ errorMessage }}
    </div>

    <app-modal-shared
      [open]="modalOpen"
      [title]="editingId ? 'Editar profesor' : 'Nuevo profesor'"
      [primaryLabel]="saving ? 'Guardando...' : 'Guardar'"
      [primaryDisabled]="saving"
      [secondaryDisabled]="saving"
      secondaryLabel="Cancelar"
      (primary)="submit()"
      (secondary)="closeModal()"
      (backdrop)="closeModal()"
    >
      <form [formGroup]="form" class="row g-3">
        <div class="col-12">
          <label class="form-label">Usuario asociado</label>
          <select class="form-select" formControlName="user_id">
            <option [ngValue]="null">Selecciona un usuario</option>
            <option *ngFor="let user of users" [ngValue]="user.id">{{ user.name }} ({{ user.email }})</option>
          </select>
        </div>
        <div class="col-md-6">
          <label class="form-label">DNI</label>
          <input class="form-control" formControlName="dni" />
        </div>
        <div class="col-md-6">
          <label class="form-label">Teléfono</label>
          <input class="form-control" formControlName="telefono" />
        </div>
        <div class="col-md-6">
          <label class="form-label">Departamento</label>
          <input class="form-control" formControlName="departamento" />
        </div>
        <div class="col-md-6">
          <label class="form-label">Especialidad</label>
          <input class="form-control" formControlName="especialidad" />
        </div>
        <div class="col-12 form-check">
          <input class="form-check-input" type="checkbox" id="profesorActivo" formControlName="activo" />
          <label class="form-check-label" for="profesorActivo">Profesor activo</label>
        </div>
      </form>
      <div class="text-danger small mt-2" *ngIf="errorMessage">{{ errorMessage }}</div>
      <div class="text-secondary small" *ngIf="saving">Guardando cambios...</div>
    </app-modal-shared>
  </div>
</app-admin-shell>

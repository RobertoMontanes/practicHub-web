<app-admin-shell>
  <div class="container-fluid">
    <div class="d-flex justify-content-between align-items-start mb-3">
      <div>
        <h3 class="text-dark m-0">Empresas</h3>
        <p class="text-secondary m-0">Gestión de empresas colaboradoras</p>
      </div>
      <button class="btn btn-dark" (click)="openCreate()">Nueva Empresa</button>
    </div>

    <div class="card shadow-sm mb-3">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <p class="text-secondary small m-0">Total de empresas</p>
          <h5 class="m-0">{{ total }}</h5>
        </div>
        <div class="d-flex align-items-center gap-2">
          <button
            class="btn btn-outline-secondary btn-sm"
            [disabled]="page <= 1 || loading"
            (click)="load(page - 1)"
          >
            Anterior
          </button>
          <span class="text-secondary small">Página {{ page }} / {{ lastPage }}</span>
          <button
            class="btn btn-outline-secondary btn-sm"
            [disabled]="page >= lastPage || loading"
            (click)="load(page + 1)"
          >
            Siguiente
          </button>
        </div>
      </div>
    </div>

    <div class="card shadow-sm">
      <div class="card-header bg-white d-flex justify-content-between align-items-center">
        <h6 class="m-0">Lista de Empresas</h6>
        <div class="d-flex align-items-center gap-2">
          <span class="text-secondary small" *ngIf="loading">Cargando...</span>
          <button class="btn btn-dark btn-sm" (click)="openCreate()">Nueva Empresa</button>
        </div>
      </div>

      <div class="table-responsive">
        <table class="table table-borderless align-middle mb-0">
          <thead class="border-bottom">
            <tr class="text-secondary small">
              <th>Empresa</th>
              <th>CIF</th>
              <th>Sector</th>
              <th>Contacto</th>
              <th>Estado</th>
              <th class="text-end">Acciones</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngIf="!loading && empresas.length === 0">
              <td colspan="6" class="text-center text-secondary py-4">
                No hay empresas registradas todavía.
              </td>
            </tr>
            <tr *ngFor="let empresa of empresas">
              <td>
                <div class="fw-semibold">{{ empresa.nombre }}</div>
                <div class="text-secondary small">{{ empresa.direccion }}</div>
              </td>
              <td>{{ empresa.cif }}</td>
              <td>{{ empresa.sector }}</td>
              <td>
                <div>{{ empresa.tutor_empresa }}</div>
                <small class="text-secondary">{{ empresa.email_tutor }}</small>
              </td>
              <td>
                <span
                  class="badge"
                  [class.bg-success]="empresa.activo"
                  [class.bg-secondary]="!empresa.activo"
                >
                  {{ empresa.activo ? 'Activa' : 'Inactiva' }}
                </span>
              </td>
              <td class="text-end">
                <button class="btn btn-sm btn-outline-secondary me-2" (click)="openEdit(empresa)">
                  Editar
                </button>
                <button class="btn btn-sm btn-outline-danger" (click)="remove(empresa)">
                  Eliminar
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="alert alert-success mt-3" role="alert" *ngIf="successMessage">
      {{ successMessage }}
    </div>

    <div class="alert alert-danger mt-3" role="alert" *ngIf="errorMessage">
      {{ errorMessage }}
    </div>

    <app-modal-shared
      [open]="modalOpen"
      [title]="editingId ? 'Editar empresa' : 'Nueva empresa'"
      [primaryLabel]="saving ? 'Guardando...' : 'Guardar'"
      [primaryDisabled]="saving"
      [secondaryDisabled]="saving"
      secondaryLabel="Cancelar"
      [disableBackdropClose]="true"
      (primary)="submit()"
      (secondary)="closeModal()"
    >
      <form [formGroup]="form" class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Nombre</label>
          <input class="form-control" formControlName="nombre" placeholder="Nombre de la empresa" />
        </div>
        <div class="col-md-6">
          <label class="form-label">CIF</label>
          <input class="form-control" formControlName="cif" placeholder="B12345678" />
        </div>
        <div class="col-md-6">
          <label class="form-label">Dirección</label>
          <input class="form-control" formControlName="direccion" />
        </div>
        <div class="col-md-6">
          <label class="form-label">Teléfono</label>
          <input class="form-control" formControlName="telefono" />
        </div>
        <div class="col-md-6">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" formControlName="email" />
        </div>
        <div class="col-md-6">
          <label class="form-label">Sector</label>
          <input class="form-control" formControlName="sector" />
        </div>
        <div class="col-md-6">
          <label class="form-label">Tutor de empresa</label>
          <input class="form-control" formControlName="tutor_empresa" />
        </div>
        <div class="col-md-6">
          <label class="form-label">Email del tutor</label>
          <input type="email" class="form-control" formControlName="email_tutor" />
        </div>
        <div class="col-12 form-check">
          <input class="form-check-input" type="checkbox" id="empresaActiva" formControlName="activo" />
          <label class="form-check-label" for="empresaActiva">Empresa activa</label>
        </div>
      </form>

      <div class="text-danger small mt-2" *ngIf="errorMessage">
        {{ errorMessage }}
      </div>
      <div class="text-secondary small" *ngIf="saving">Guardando cambios...</div>
    </app-modal-shared>
  </div>
</app-admin-shell>
